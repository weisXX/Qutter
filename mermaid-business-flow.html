<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mermaid 业务流程图示例</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@11.12.2/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        .example {
            flex: 1;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .mermaid {
            background: white;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #eee;
            margin: 10px 0;
        }
        h2 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
            font-family: 'Consolas', monospace;
            font-size: 14px;
        }
        .error {
            color: #d32f2f;
            background: #ffebee;
            padding: 10px;
            border-radius: 3px;
            margin: 10px 0;
        }
        .success {
            color: #388e3c;
            background: #e8f5e8;
            padding: 10px;
            border-radius: 3px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Mermaid 业务流程图示例</h1>
    
    <div class="error">
        <strong>你遇到的错误:</strong> Parse error on line 5: ... --> E[调用 Order API (POST /order/create)
        <br>原因: Mermaid 流程图语法不正确，箭头和节点定义有误。
    </div>
    
    <div class="container">
        <div class="example">
            <h2>1. 正确的业务流程图语法</h2>
            <div class="mermaid" id="flowchart1">
            </div>
            <pre id="code1"></pre>
        </div>
        
        <div class="example">
            <h2>2. 带判断分支的流程图</h2>
            <div class="mermaid" id="flowchart2">
            </div>
            <pre id="code2"></pre>
        </div>
    </div>
    
    <div class="container">
        <div class="example">
            <h2>3. 带异常处理的流程图</h2>
            <div class="mermaid" id="flowchart3">
            </div>
            <pre id="code3"></pre>
        </div>
        
        <div class="example">
            <h2>4. 你提供的时序图（正确示例）</h2>
            <div class="mermaid" id="sequence1">
            </div>
            <pre id="code4"></pre>
        </div>
    </div>
    
    <div class="success">
        <h3>Mermaid 流程图语法要点:</h3>
        <ol>
            <li>以 <code>flowchart TD</code> 或 <code>flowchart LR</code> 开头（TD=从上到下，LR=从左到右）</li>
            <li>节点定义: <code>A[描述文字]</code> 或 <code>A(描述文字)</code></li>
            <li>连接线: <code>A --> B</code> 或 <code>A -- 描述文字 --> B</code></li>
            <li>判断节点: <code>A{判断条件}</code></li>
            <li>子图: <code>subgraph 子图名称 ... end</code></li>
        </ol>
    </div>
    
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true
            }
        });
        
        // 示例1: 简单的业务流程图
        const flowchart1 = `flowchart TD
    A[用户发起请求] --> B{请求验证}
    B -->|验证通过| C[处理业务逻辑]
    B -->|验证失败| D[返回错误信息]
    C --> E[调用外部API]
    E --> F{API响应}
    F -->|成功| G[返回成功结果]
    F -->|失败| H[处理异常]
    H --> I[记录错误日志]
    I --> J[返回友好错误提示]
    G --> K[结束]
    J --> K`;
        
        // 示例2: 带详细分支的流程图
        const flowchart2 = `flowchart TD
    Start[开始] --> A[接收用户输入]
    A --> B{输入验证}
    
    B -->|格式正确| C[数据预处理]
    B -->|格式错误| Error1[返回格式错误提示]
    
    C --> D{业务规则检查}
    D -->|检查通过| E[执行核心业务]
    D -->|检查不通过| Error2[返回业务规则错误]
    
    E --> F[调用订单API]
    F --> G{API响应状态}
    G -->|200 OK| H[解析响应数据]
    G -->|4xx 客户端错误| Error3[处理客户端错误]
    G -->|5xx 服务器错误| Error4[处理服务器错误]
    
    H --> I[数据后处理]
    I --> J[返回最终结果]
    J --> End[流程结束]
    
    Error1 --> End
    Error2 --> End
    Error3 --> End
    Error4 --> End`;
        
        // 示例3: 带异常处理的完整流程图
        const flowchart3 = `flowchart TD
    Start([流程开始]) --> Auth{用户认证}
    
    Auth -->|已认证| Validate[验证请求参数]
    Auth -->|未认证| AuthError[返回认证错误<br>HTTP 401]
    
    Validate --> ParamCheck{参数检查}
    ParamCheck -->|参数有效| BusinessLogic[执行业务逻辑]
    ParamCheck -->|参数无效| ParamError[返回参数错误<br>HTTP 400]
    
    subgraph BusinessProcess [业务处理]
        BusinessLogic --> APICall[调用外部服务]
        APICall --> Response{响应处理}
        Response -->|成功| Parse[解析响应]
        Response -->|失败| APIFail[处理API失败]
    end
    
    Parse --> DataTransform[数据转换]
    DataTransform --> FinalCheck{最终检查}
    
    FinalCheck -->|检查通过| Success[返回成功响应<br>HTTP 200]
    FinalCheck -->|检查不通过| BizError[返回业务错误<br>HTTP 422]
    
    APIFail --> Retry{是否重试?}
    Retry -->|是| APICall
    Retry -->|否| APIFinalError[返回服务不可用<br>HTTP 503]
    
    Success --> End([流程结束])
    AuthError --> End
    ParamError --> End
    BizError --> End
    APIFinalError --> End`;
        
        // 示例4: 时序图
        const sequence1 = `sequenceDiagram
    participant 用户
    participant 前端
    participant 服务器
    participant 数据库
    
    用户->>前端: 发送请求
    前端->>服务器: API调用 (POST /order/create)
    服务器->>数据库: 查询数据
    数据库-->>服务器: 返回查询结果
    服务器->>服务器: 业务逻辑处理
    服务器-->>前端: 返回响应数据
    前端-->>用户: 显示结果`;
        
        // 设置代码显示
        document.getElementById('code1').textContent = flowchart1;
        document.getElementById('code2').textContent = flowchart2;
        document.getElementById('code3').textContent = flowchart3;
        document.getElementById('code4').textContent = sequence1;
        
        // 渲染图表
        try {
            document.getElementById('flowchart1').innerHTML = flowchart1;
            document.getElementById('flowchart2').innerHTML = flowchart2;
            document.getElementById('flowchart3').innerHTML = flowchart3;
            document.getElementById('sequence1').innerHTML = sequence1;
            
            // 重新初始化渲染
            mermaid.init();
        } catch (error) {
            console.error('Mermaid 渲染错误:', error);
        }
    </script>
</body>
</html>