<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>架构图测试</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@11.12.2/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-container {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .mermaid {
            background: white;
            padding: 20px;
            border-radius: 4px;
            border: 1px solid #eee;
            margin: 10px 0;
        }
        .error {
            color: red;
            background: #ffebee;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            color: green;
            background: #e8f5e8;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-family: 'Consolas', monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>架构图测试</h1>
    
    <div class="test-container">
        <h2>测试1: 简单架构图</h2>
        <div class="mermaid">
flowchart TD
    A[用户] --> B[前端]
    B --> C[API网关]
    C --> D[后端服务]
    D --> E[数据库]
        </div>
    </div>

    <div class="test-container">
        <h2>测试2: 横向架构图</h2>
        <div class="mermaid">
flowchart LR
    A[客户端] --> B[负载均衡器]
    B --> C[Web服务器1]
    B --> D[Web服务器2]
    C --> E[应用服务器]
    D --> E
    E --> F[数据库]
        </div>
    </div>

    <div class="test-container">
        <h2>测试3: 带子图的架构图</h2>
        <div class="mermaid">
flowchart LR
    A[用户] --> B[API网关]
    
    subgraph "前端层"
        C[Web应用]
        D[移动应用]
    end
    
    B --> E[业务服务]
    E --> F[数据服务]
    F --> G[数据库]
        </div>
    </div>

    <div class="test-container">
        <h2>测试4: 4C架构图</h2>
        <div class="mermaid">
flowchart LR
    Customer[客户] --> Context[4C Context]
    
    subgraph "4C理论"
        Cost[成本 Cost]
        Convenience[便利性 Convenience]
        Communication[沟通 Communication]
        Choice[选择 Choice]
    end
    
    Context --> Cost
    Context --> Convenience
    Context --> Communication
    Context --> Choice
        </div>
    </div>

    <div class="test-container">
        <h2>测试5: 系统架构图</h2>
        <div class="mermaid">
flowchart TB
    subgraph "表示层"
        A[Web界面]
        B[移动应用]
    end
    
    subgraph "业务逻辑层"
        C[用户服务]
        D[订单服务]
        E[支付服务]
    end
    
    subgraph "数据层"
        F[MySQL数据库]
        G[Redis缓存]
    end
    
    A --> C
    B --> C
    C --> F
    D --> F
    E --> F
    C --> G
    D --> G
    E --> G
        </div>
    </div>

    <div id="results"></div>

    <script>
        // 初始化Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis',
                defaultRenderer: 'elk'
            },
            mindmap: {
                useMaxWidth: true,
                padding: 20
            },
            classDiagram: {
                useMaxWidth: true,
                htmlLabels: true
            }
        });

        // 测试渲染
        function testRendering() {
            const results = document.getElementById('results');
            results.innerHTML = '<h2>测试结果</h2>';
            
            const mermaidElements = document.querySelectorAll('.mermaid');
            
            mermaidElements.forEach((element, index) => {
                const testNumber = index + 1;
                const title = element.previousElementSibling.textContent;
                
                setTimeout(() => {
                    const svg = element.querySelector('svg');
                    const resultDiv = document.createElement('div');
                    
                    if (svg) {
                        resultDiv.className = 'success';
                        resultDiv.innerHTML = `<strong>测试 ${testNumber} (${title}): 成功</strong> - SVG已生成`;
                        
                        // 检查SVG内容
                        const svgContent = svg.outerHTML;
                        console.log(`测试 ${testNumber} SVG内容:`, svgContent.substring(0, 200) + '...');
                    } else {
                        resultDiv.className = 'error';
                        resultDiv.innerHTML = `<strong>测试 ${testNumber} (${title}): 失败</strong> - 未找到SVG`;
                        
                        // 显示原始内容
                        const contentDiv = document.createElement('div');
                        contentDiv.innerHTML = `<strong>原始内容:</strong>`;
                        const pre = document.createElement('pre');
                        pre.textContent = element.textContent;
                        contentDiv.appendChild(pre);
                        resultDiv.appendChild(contentDiv);
                    }
                    
                    results.appendChild(resultDiv);
                }, 1000);
            });
        }

        // 页面加载完成后运行测试
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(testRendering, 500);
        });
    </script>
</body>
</html>